{% extends "base.html" %}

{% block title %}Import Data â€” Prism{% endblock %}

{% block content %}
<div class="max-w-2xl mx-auto space-y-8">
    
    <!-- Header -->
    <div class="text-center">
        <h1 class="text-3xl font-bold text-white">Import Data</h1>
        <p class="mt-2 text-dark-400">Upload transcripts, deals, or pipeline data</p>
    </div>
    
    <!-- Upload Card -->
    <div class="gradient-border rounded-2xl p-8">
        <form method="POST" enctype="multipart/form-data" id="uploadForm" class="space-y-6">
            
            <!-- Drag & Drop Zone -->
            <div class="relative" id="dropZone">
                <input type="file" name="file" id="fileInput" accept=".json,.txt,.csv"
                       class="absolute inset-0 w-full h-full opacity-0 cursor-pointer z-10">
                
                <div class="p-12 rounded-xl border-2 border-dashed border-dark-600 hover:border-accent/50 
                            transition-all text-center bg-dark-800/30" id="dropArea">
                    <div class="w-16 h-16 rounded-2xl bg-accent/10 flex items-center justify-center mx-auto mb-4">
                        <i data-lucide="upload-cloud" class="w-8 h-8 text-accent" id="uploadIcon"></i>
                    </div>
                    <div class="text-lg font-medium text-white mb-2" id="dropText">
                        Drop files here or click to browse
                    </div>
                    <p class="text-sm text-dark-400">
                        Supports JSON, TXT, and CSV files
                    </p>
                </div>
            </div>
            
            <!-- File Preview -->
            <div id="filePreview" class="hidden p-4 rounded-xl bg-dark-800 border border-dark-700">
                <div class="flex items-center justify-between">
                    <div class="flex items-center gap-3">
                        <div class="w-10 h-10 rounded-lg bg-accent/20 flex items-center justify-center">
                            <i data-lucide="file-text" class="w-5 h-5 text-accent"></i>
                        </div>
                        <div>
                            <div class="font-medium text-white" id="fileName">filename.json</div>
                            <div class="text-sm text-dark-400" id="fileSize">0 KB</div>
                        </div>
                    </div>
                    <button type="button" id="removeFile" 
                            class="p-2 rounded-lg hover:bg-dark-700 text-dark-400 hover:text-white transition-all">
                        <i data-lucide="x" class="w-5 h-5"></i>
                    </button>
                </div>
            </div>
            
            <!-- Submit -->
            <button type="submit" id="submitBtn" disabled
                    class="w-full flex items-center justify-center gap-2 px-6 py-4 rounded-xl 
                           bg-accent hover:bg-accent-dim disabled:bg-dark-700 disabled:text-dark-500
                           text-white font-semibold transition-all hover:shadow-glow disabled:cursor-not-allowed">
                <i data-lucide="upload" class="w-5 h-5"></i>
                Upload & Process
            </button>
        </form>
    </div>
    
    <!-- Instructions -->
    <div class="gradient-border rounded-xl p-6">
        <h2 class="text-lg font-semibold text-white mb-4">Supported Formats</h2>
        
        <div class="space-y-4">
            <div class="flex items-start gap-4">
                <div class="w-10 h-10 rounded-lg bg-blue-500/20 flex items-center justify-center flex-shrink-0">
                    <span class="text-sm font-bold text-blue-400">JSON</span>
                </div>
                <div>
                    <div class="font-medium text-dark-100">JSON Pipeline Export</div>
                    <p class="text-sm text-dark-400 mt-1">
                        Array of prospect/deal objects with name, company, stage, pain_points, objections, etc.
                    </p>
                </div>
            </div>
            
            <div class="flex items-start gap-4">
                <div class="w-10 h-10 rounded-lg bg-emerald-500/20 flex items-center justify-center flex-shrink-0">
                    <span class="text-sm font-bold text-emerald-400">TXT</span>
                </div>
                <div>
                    <div class="font-medium text-dark-100">Call Transcripts</div>
                    <p class="text-sm text-dark-400 mt-1">
                        Raw meeting transcripts. We'll extract entities, pain points, and signals automatically.
                    </p>
                </div>
            </div>
            
            <div class="flex items-start gap-4">
                <div class="w-10 h-10 rounded-lg bg-amber-500/20 flex items-center justify-center flex-shrink-0">
                    <span class="text-sm font-bold text-amber-400">CSV</span>
                </div>
                <div>
                    <div class="font-medium text-dark-100">CRM Export</div>
                    <p class="text-sm text-dark-400 mt-1">
                        Standard CRM export with columns for contact name, company, stage, deal value.
                    </p>
                </div>
            </div>
        </div>
    </div>
    
    <!-- API Integration -->
    <div class="gradient-border rounded-xl p-6">
        <h2 class="text-lg font-semibold text-white mb-4 flex items-center gap-2">
            <i data-lucide="plug" class="w-5 h-5 text-accent"></i>
            API Integration
        </h2>
        
        <p class="text-dark-400 mb-4">
            Connect your CRM directly for automatic sync. Coming soon:
        </p>
        
        <div class="grid grid-cols-3 gap-4">
            <div class="p-4 rounded-xl bg-dark-800/50 border border-dark-700 text-center opacity-50">
                <span class="text-sm text-dark-400">Salesforce</span>
            </div>
            <div class="p-4 rounded-xl bg-dark-800/50 border border-dark-700 text-center opacity-50">
                <span class="text-sm text-dark-400">HubSpot</span>
            </div>
            <div class="p-4 rounded-xl bg-dark-800/50 border border-dark-700 text-center opacity-50">
                <span class="text-sm text-dark-400">Pipedrive</span>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
    lucide.createIcons();
    
    const fileInput = document.getElementById('fileInput');
    const dropArea = document.getElementById('dropArea');
    const dropText = document.getElementById('dropText');
    const uploadIcon = document.getElementById('uploadIcon');
    const filePreview = document.getElementById('filePreview');
    const fileName = document.getElementById('fileName');
    const fileSize = document.getElementById('fileSize');
    const removeFile = document.getElementById('removeFile');
    const submitBtn = document.getElementById('submitBtn');
    
    // File selection
    fileInput.addEventListener('change', handleFile);
    
    function handleFile(e) {
        const file = e.target.files[0];
        if (file) {
            fileName.textContent = file.name;
            fileSize.textContent = formatBytes(file.size);
            filePreview.classList.remove('hidden');
            dropArea.classList.add('border-success/50');
            submitBtn.disabled = false;
        }
    }
    
    // Remove file
    removeFile.addEventListener('click', () => {
        fileInput.value = '';
        filePreview.classList.add('hidden');
        dropArea.classList.remove('border-success/50');
        submitBtn.disabled = true;
    });
    
    // Drag & drop
    ['dragenter', 'dragover'].forEach(event => {
        dropArea.addEventListener(event, (e) => {
            e.preventDefault();
            dropArea.classList.add('border-accent', 'bg-accent/5');
        });
    });
    
    ['dragleave', 'drop'].forEach(event => {
        dropArea.addEventListener(event, (e) => {
            e.preventDefault();
            dropArea.classList.remove('border-accent', 'bg-accent/5');
        });
    });
    
    // Format bytes
    function formatBytes(bytes) {
        if (bytes === 0) return '0 Bytes';
        const k = 1024;
        const sizes = ['Bytes', 'KB', 'MB', 'GB'];
        const i = Math.floor(Math.log(bytes) / Math.log(k));
        return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
    }
    
    // Form submit
    document.getElementById('uploadForm').addEventListener('submit', function() {
        submitBtn.innerHTML = '<i data-lucide="loader-2" class="w-5 h-5 animate-spin"></i> Processing...';
        submitBtn.disabled = true;
        lucide.createIcons();
    });
</script>
{% endblock %}
